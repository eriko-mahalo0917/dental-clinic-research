# DENTAL-CLINIC-RESEARCH

このツールは、  
スプレッドシートに入力されたクリニック名をもとに  
Googleマップから基本情報や口コミを取得し、  
自動でワークシートを作成するリサーチツールです。

---

## 🟡 このツールでできること

1. クリニック一覧シートを読み込む  
2. 未処理のクリニックを抽出  
3. Googleマップから情報を取得  
4. クリニックごとのワークシートを自動作成  
5. 情報と口コミを書き込み  
6. ステータスを「WS作成済み」に更新  

ボタン操作は不要で、実行すると自動で処理されます。

## 🟡処理フロー
1. スプレッドシートからクリニック一覧を取得
2. ステータスが未処理のクリニック名を抽出
3. Google Maps APIでクリニック情報・口コミを取得
4. スプレッドシートへ書き込める形式にデータを整形
5. クリニックごとのワークシートを作成
6. 基本情報・口コミを書き込み
7. 一覧シートのステータスを「WS作成済み」に更新

## 🟡ファイル構成と役割
### sheets_reader.py
Googleスプレッドシートからデータを取得する役割を担います。

- サービスアカウント（creds.json）を用いた認証
- 指定したワークシートを DataFrame として取得
- ステータスが空白のクリニック名を抽出

### gmaps_api.py
GoogleMaps API を利用してクリニック情報を取得します。

- クリニック名による検索
- place_idの取得
- 基本情報の取得（住所・TEL・URL・評価・総合レビュー（総合評価））
- 口コミを最大５件取得

### clinic_data_flow.py
取得した情報をスプレッドシートに書き込める形式にします。

- １店舗分：基本情報 + 口コミを１行のDictにまとめる
- データが存在しない項目は空白

### sheets_writer.py
Google Sheet APIを利用してワークシート作成 ＋ データ書き込み + ステータス更新を行います。

- クリニック名をシート名としてワークシートを一括処理
- ヘッダー行とデータを書き込み
- ヘッダーの背景色を設定
- クリニック一覧シートのステータスを「WS作成済み」に更新

### main_flow.py
各処理を組み合わせて、処理全体の流れとなります。

- クリニック一覧取得
- Google Maps API 呼び出し
- データ整形
- スプレッドシート書き込み処理の実行

### main.py
このファイルを実行することで、処理が実行されます。


---

## 🟡 事前準備（重要：初期設定）

本ツールを利用するには、ご自身の Google アカウントで認証情報（電子キー）を発行し、ツールにセットアップする必要があります。以下の手順に沿って設定をお願いします。

### 1. Google API 認証ファイル（creds.json）の取得と配置

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスし、新しいプロジェクトを作成します。
2. 以下の2つのAPIを検索し、それぞれ「有効にする」をクリックしてください。
   - **Google Sheets API**
   - **Places API** （またはご利用の Google Maps 関連API）
3. 左側メニューの「認証情報」から「＋認証情報を作成」＞「サービスアカウント」を選択して作成します。
4. 作成したサービスアカウントをクリックし、「キー」タブから「鍵を追加」＞「新しい鍵を作成」＞「JSON」を選択してダウンロードします。
5. ダウンロードしたファイルの名前を **`creds.json`** に変更してください。
6. この `creds.json` ファイルを、本ツール（`DentalClinicResearch` の実行ファイル）と**同じフォルダ内**に配置してください。

### 2. スプレッドシートへのアクセス権限付与

ツールがスプレッドシートにデータを書き込めるように、専用アカウントを招待します。

1. Google Cloud Console のサービスアカウント画面で、作成したサービスアカウントの「メールアドレス（〜@〜.iam.gserviceaccount.com）」をコピーします。
2. 利用する対象のスプレッドシートを開きます。
3. 右上の「共有」ボタンをクリックします。
4. コピーしたメールアドレスを追加し、権限を **「編集者」** にして保存してください。

### 3. Google Maps APIキーの取得と設定 (.env)

スプレッドシートの権限設定が終わったら、次にマップ検索用の「APIキー」を発行します。

1. Google Cloud Console の左側メニューから「APIとサービス」＞「認証情報」を開きます。
2. 画面上の「＋認証情報を作成」をクリックし、**「API キー」** を選択します。
3. 「APIキーを作成しました」という画面が出たら、表示されたキー（AIza...から始まる長い文字列）をコピーします。
4. 本ツールに同梱されている **`.env`** ファイルを、メモ帳などのテキストエディタで開きます。
5. コピーしたAPIキーを貼り付けて、上書き保存してください。
   （例：`Maps_API_KEY="**************"` ※ `""`の間に貼り付けます）

※リポジトリには含めません。
---

## 🟡 実行方法

1. すべての設定が完了していることを確認  
2. `main.exe` をダブルクリック  

処理が自動で開始されます。

---

## 🟡ファイル階層
```
DENTAL-CLINIC-RESEARCH/
├ google_apis/
│   ├ gmaps_api.py
│   ├ sheets_reader.py
│   └ sheets_writer.py
├ models/
│   └ clinic_data_flow.py
├ utils/
│   └ logger.py
├ config.py
├ main_flow.py
├ main.py
├ requirements.txt
├ .env
├ creds.json
└ README.md
```


## ⚠️注意点

- 本ツールは、スプレッドシートの構成（シート名・列構成）が
  想定された形式であることを前提としています。
  構成を変更した場合、正常に動作しない可能性があります。

- `creds.json` や `.env` ファイルには機密情報が含まれるため、
  GitHubなどのリポジトリには絶対に含めないでください。